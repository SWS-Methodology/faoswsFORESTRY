--- 
title: "Migration of FORESTRY PRODUCTION AND TRADE Statistical Processes into the SWS"
author: "Francy Lisboa (Statistician, ESSD - Methodological Innovation Team, FAO)"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
output: bookdown::gitbook
css: ess.css
documentclass: book
link-citations: yes
description: "The online book describes steps towards the migration of the current FORESTRY PRODUCTION AND TRADE statistical processes into the Corporate Statistical Working System (SWS)"
---

# **Introduction** {-}

The country-level **FORESTRY PRODUCTION AND TRADE STATISTICS (FPT)** are annually disseminated by FAO on [FAOSTAT] http://www.fao.org/faostat/en/#data/FO). The statistical value chain on this exercise involves a series of different actors through which the data is acquired, processed, validated, and disseminated for public usage. Even though the FPT chain has been working timely for years, there is a need to standardize the processes into the corporate Statistical Working System with the promise of better management of statistical objects involved by making them findable, accessible, and re-usable. 

Therefore, this online document describes the main institutional actors involved in the migration as well as the FORESTRY PRODUCTION AND TRADE resources (**code lists**, **datasets**, **data tables**)  created to support the SWS plugins (R modules) to meet technical unit requirements.  Furthermore, the SWS plugins are presented in the form of chapters providing a detailed description of their workflows involving **input -> processing -> output** as well as results showing whether the modules have lived up to expectations.

```{block , type='rmdnote'}
**IMPORTANT:**
Use the **Chrome browser** to have a correct vizualization of HTML outputs in this online document.

```

# **Migration actors** {-}

Any migration into the SWS requires the interaction between at least three actors: 

1. The **technical unit** interested in automating either some or all its analytical processes in the SWS. The technical unit can be treated as client demanding services from the counterparts responsible for the implementation of its data and statistical assets in the SWS. Therefore, a successful FORESTRY PRODUCTION AND TRADE migration depends on the coordination between the technical division and other parts. In the AQUASTAT - SWS migration framework the technical unit is called AQUASTAT and is represented by:

  - **Arvydas Lebedys** *Forestry Officer (FOA)*
  - **Roberto Bargigia** *Forestry clerk (FOA)*

2. The **ESS - Methodological Innovation Team** (ESS - SWS) responsible for the implementation and documentation of the required statistical processes. From the ESS - SWS team the focal points for AQUASTAT - SWS migration are:

  - **Francy Lisboa** *Agronomist/Statistician (ESSD)*
  - **Luis Silva** *Statistician (ESSD)*
  - **Carola Fabi** *Statistician (ESSD)*
  
3. The **CIO - SWS** the **primary backend and frontend maintainer of the SWS** and responsible for the implementation and documentation of non-statistical processes (IT infrastructure). The CIO - SWS team have as interlocutors:

  - **Enrico Anello** *Full Stack Developer (CIO)*
  - **Matteo Terrinoni** *Full Stack Developer (CIO)*
  - **John Rowell** *Information Technology Officer (CIO)*
  

# **Current Foretry Production and Trade workflow**{-}

The book focuses on SWS statistical processes on progress. However, it is important to provide an overview of the current statistical value chain carried by FOA. 

## **Data Collection** {-}
The FORESTRY PRODUCTION AND TRADE data collection relies on the [Joint Forestry Sector Questionnaire distpatch](http://www.fao.org/forestry/statistics/jfsq/en/). The dispatch of the [same harmonized questionnaire](http://www.fao.org/forestry/statistics/jfsq/en/) is carried out by FAO by its international partners:
  
  - **ITTO** : The [International Tropical Timber Organization](https://www.itto.int/)
  - **Eurostat** : The [European Statistics](https://ec.europa.eu/eurostat)
  - **UNECE** : The [United Nations Economic Comission for Europe](http://www.unece.org/info/ece-homepage.html)

FAO sends questionnaires to countries in May/June and the deadline for the first response is September 1st. The partners send out questionnaires between April and June and FAO receives validated data from partners from July to November.

## **Data Imput System** {-}
As the questionnaires are sending back to FAO, the data enters as csv file in the Microsoft Access - driven FAOSTAT Input System, which was created and  is primarily managed by the FAO  Statistical Division ( **Amanda Gordon (ESSD - Statistician**). The FOA unit responsible for Forestry Production and Trade has permissions to work in it to put forward the data processing and validation processes needed before dissemination.
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Frontpage of the current Forestry Input System', message=FALSE, warning=FALSE}
knitr::include_graphics("images/current_system_01.png")
```
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Frontpage of the current Forestry Input System', message=FALSE, warning=FALSE}
knitr::include_graphics("images/current_system_02.png")
```
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Current FOA Workflow', message=FALSE, warning=FALSE}
knitr::include_graphics("images/current_processing.png")
```
<br>
<br>
<br>

## **Dissemination System** {-}
After processing the data, the FOA unit sends the country level results to the FAO Statistics Division for dissemination. 

```{r , echo=FALSE, out.width="100%", fig.cap='Forestry Production and Trade dissemination page (FAOSTAT)', message=FALSE, warning=FALSE}
knitr::include_graphics("images/faostat_dissemination.png")
```

# **Gathering requirements** {-}
The ESS-SWS team held meetings with FOA in order to collect what should be migrated from the current system into the SWS.Before dissemination, the final FAOSTAT - based Forestry commodity and geographic aggregations are carried at Statistics Division level by **Amanda Gordon (ESSD- Statistician)**. However, the current systems provides FOA a way to compute these aggregations as a validation step so that the officer can apply domain-knowledge before the green light for aggregation at the ESSD level. Therefore, ESS-SWS team has been asked to replicate this functionality in the SWS.

# **Proposed automations** {-}
As one sees, in many steps of the Forestry workflow, the human interference is patently present. While it is indisputable that deep domain expertise cannot be easily replace by algorithms, the ESS - SWS team identified data processing layers where automation can be applied without decreasing the importance of FOA domain knowledge interference (**in red**).
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Proposed migration of FOA data processing steps (in red).', message=FALSE, warning=FALSE}
knitr::include_graphics("images/portable_steps.png")
```
<br>

#**Forestry Statistical Objects** {-}
In the SWS parlance, statistical objects comprise an hierarchy of domain, datatables, data sets, harvesters, metadata, and code lists (reference data). 

```{r , echo=FALSE, out.width="100%", fig.cap='SWS statistical domains', message=FALSE, warning=FALSE}
knitr::include_graphics("images/statistical_objects.png")
```


## **Domain** {-}
Domains in SWS encapsulates the statistical objects in SWS so that they are easily find in context. The Forestry domain can be accessed either by clicking on Domain on the SWS Administration console. Within the domain, associated data tables, datasets, code lists (reference data) and R plugins can be find. 


## **Forestry Code lists** {-}
Code lists, also called reference data in SWS parlance, are the dimensions making up the data sets that are designed by the user to store analytical results from SWS modules. The dimensions are statistical - domain-specific and are defined by the technical unit to reflect its needs regarding data collection, processing, and dissemination while meeting FAO standards. Each data set dimension has a set of codes and their associated descriptions. Therefore, code lists serve to the purpose of standardization, visualization, and metadata by associating standardized codes to standardized names in the SWS data set outputs. In the SWS Forestry domain the used code lists are


1. **geographicAreaM49**. Representing a spatial scale the information is measured at. For example, countries, territories, regional aggregates, regional special groups aggregates, global aggregates. This code list befits the [UNSD M49](https://unstats.un.org/unsd/methodology/m49/) country level codes.
<br>
2. **measuredItemForestry**. Those one wants to take a measurement from. For example, forestry commodities, forestry commodity groups. Forestry commodity classifications and standards are available at [this link](http://www.fao.org/forestry/statistics/80572/en/).
<br>
```{r tab1, echo=FALSE, message=FALSE}
suppressWarnings({
require(data.table)
require(kableExtra)
})
d = data.table::fread("tables/items_forestry.csv")
knitr::kable(d,
             caption = paste("FORESTRY commodity codes in the measuredItemForestry code list."),
             booktabs = TRUE) %>%
  kableExtra::kable_styling(font_size = 12)
```
<br>
3. **measuredElement**. Code list representing a measurement  that can be taken across different items. For example, production, import quantity, import value, export quantity, export value, unit price.
<br>
4. **timePointYears**. Code list representing the time unit the data is displayed: year, months, etc. 
<br>
5. **flagObservationStatus**. Code list representing a standardized label indicating origin and/or nature of a number in the data set, e.g. <blank> (Official figure). Please check the [OCS statistical standards](http://intranet.fao.org/statistics_coordination_portal/standards_for_quality_compliance/) and the [flags document](http://intranet.fao.org/fileadmin/user_upload/scp/Standards_for_quality_compliance/SSS1_Flags.pdf) to understand the flagObservationStatus rational and  obtain the description of flags.
<br>
6. **flagMethod**. Code list for internal use (not dissemination) representing a standardized label indicating method utilized to obtain a figure in the data set (FAO questionnaire, external database, estimation, imputation, expert, etc. Please check the [OCS statistical standards](http://intranet.fao.org/statistics_coordination_portal/standards_for_quality_compliance/) and the [flags document](http://intranet.fao.org/fileadmin/user_upload/scp/Standards_for_quality_compliance/SSS1_Flags.pdf) to understand the flagMethod rational and  obtain the description of flags.
<br>
```{r tab2, echo=FALSE, message=FALSE}
suppressWarnings({
require(data.table)
require(kableExtra)
})
d = suppressWarnings(data.table::fread("tables/flag_conversion.csv"))
knitr::kable(d,
             caption = paste("FAOSTAT-SWS mapping for observations and methods in Forestry."),
             booktabs = TRUE) %>%
  kableExtra::kable_styling(font_size = 12)
```


## **Data tables** {-}

Data tables are mainly used to store information helping R modules to output analytical results. Information in data tables can be of a number of types. For example, conversion factors, arithmetic formulas, mapping between flags, mapping between international classifications, etc. In SWS hierarchy, all data tables reside in a given statistical domain. In the FORESTRY PRODUCTION AND TRADE migration framework, the data tables are, of course, in the **Forestry domain**. Below is a list of current available and filled data tables in the Forestry domain:

1. **forestry_aggregation_tree**. A data table with group commodity and their primary commodities.
```{r tab3, echo=FALSE, message=FALSE}
suppressWarnings({
require(data.table)
require(kableExtra)
})
d = suppressWarnings(data.table::fread("tables/aggregation_tree.csv"))
knitr::kable(d,
             caption = paste("FORESTRY aggregation tree. A SWS data table establishing the relationship between primary and grouped commodities."),
             booktabs = TRUE) %>%
  kableExtra::kable_styling(font_size = 12)
```
<br>
<br>
2. **forestry_domain_elements**. An SWS data table storing relevant Forestry elements as listed before and used to filter input dataset.
<br>
3. **m49_fs_iso_mapping**. An SWS dataset data table storing the mapping between FAOSTAT and UNSD M49 codes used to carry geographic aggregations. This mapping table was imported from here []
<br>
```{r tab4, echo=FALSE, message=FALSE}
suppressWarnings({
require(data.table)
require(kableExtra)
})
d = suppressWarnings(data.table::fread("tables/m49_fs_iso_mapping.csv"))
knitr::kable(d,
             caption = paste("Mapping betweeb FAOSTAT and UNSD M49 geographic codes."),
             booktabs = TRUE) %>%
  kableExtra::kable_styling(font_size = 12)
```


## **Data sets** {-}
Datasets in the SWS are interchangeably used as module inputs/outputs and are composed by dimensions (aka reference/code lists). Because SWS datasets contain code lists following international standards as dimensions, there is little space for variation of dimension names across SWS datasets for the sake of standardization. The datasets in the Forestry domain are:

1. **forestry_prod_trade**. The working dataset migrated from the current Input System into the SWS. **It is expected to be periodically manually edited by the technical unit (FOA) team. Changes made on this dataset may involve the domain-knowledge replacement of values due to arrival of new data at the end of data cycles and cell-level corrections via domain-knowledge**. Most importantly, after alterations, and if FOA wants so, this data set is used as **INPUT** to the **faoswsForestryAggregation** module. Details on the use of this dataset are in the (Chapter \@ref(faoswsForestryAggregation). 
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Query page of the forestry_prod_trade data set.', message=FALSE, warning=FALSE}
knitr::include_graphics("images/legacy_sws_query.png")
```
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Example of the populated forestry_prod_trade data set in the SWS.', message=FALSE, warning=FALSE}
knitr::include_graphics("images/legacy_sws_query_02.png")
```

2. **forestry_prod_trade_agg**. An SWS dataset serving as **OUTPUT** of the  **faoswsForestryAggregation**. It receives the geographic and commodity aggregations **AFTER WHATEVER SAVED CHANGE IN THE  forestry_prod_trade data set**. Details on the use of this dataset are in the (Chapter \@ref(faoswsForestryAggregation).
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Query page of the **forestry_prod_trade_agg** data set.', message=FALSE, warning=FALSE}
knitr::include_graphics("images/agg_query_SWS.png")
```
<br>
<br>
```{r , echo=FALSE, out.width="100%", fig.cap='Example of the populated **forestry_prod_trade_agg** data set in the SWS.', message=FALSE, warning=FALSE}
knitr::include_graphics("images/agg_data_SWS.png")
```
